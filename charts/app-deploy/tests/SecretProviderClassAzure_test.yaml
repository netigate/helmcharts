---
suite: SecretProviderClassAzure create
templates:
  - templates/SecretProviderClassAzure.yaml
tests:
  - it: should render
    set:
      app.name: my-app
      app.namespace: my-ns
      Deployment:
        replicas: 1
        containers:
          - name: my-container
            SecretProviderClass:
              azure:
                create: true
                name: my-keyvault
                tenantId: my-tenant-id
                userAssignedIdentityID: my-user-assigned-identity-id
                secrets:
                  - name: my-secret
                    envVarName: EXAMPLE_SECRET1

    asserts:
      - isKind:
          of: SecretProviderClass
      - hasDocuments:
          count: 1
      - equal:
          path: spec.parameters.objects
          value: |
            array:
            - |
              objectName: my-secret
              objectType: secret
              objectVersion: ""
---
suite: SecretProviderClassAzure not create
templates:
  - templates/SecretProviderClassAzure.yaml
tests:
    - it: should not render SecretProviderClass
      set:
        SecretProviderClass:
          azure:
            create: false
      asserts:
      - hasDocuments:
          count: 0
